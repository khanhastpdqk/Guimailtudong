<script>
    async function sendEmail(recipientEmail, studentName, courseName, centerName, id) {
        try {
            emailjs.init("6q3zUEAeQ3EKysg6Y");

            const imageUrl = "https://i.imgur.com/Gappvr5.jpg";

            const emailSubject = `BÁO CÁO HOÀN THÀNH KHÓA HỌC: ${courseName}`;
            const emailBody = `
                <p>RIEM XÁC NHẬN:</p>
                <p>Dear anh/chị đầu mối cơ sở ${centerName},</p>
                <p>Học viên <strong>${studentName}</strong>, mã nhân viên: <strong>${id}</strong> đã hoàn thành khóa học: <strong>${courseName}</strong>. Vui lòng ghi nhận thông tin này.</p>
                <p>Anh/chị có thể xem ảnh chứng nhận tại liên kết sau:</p>
                <p><a href="${imageUrl}" target="_blank">Xác nhận</a></p>
                <p>Trân trọng,</p>
                <p>-- TRUNG TÂM ĐÀO TẠO RIEM --</p>
            `;

            await emailjs.send("service_thphcyi", "template_qu58yjn", {
                to_email: recipientEmail,
                subject: emailSubject,
                message: emailBody,
                center_name: centerName,
                student_name: studentName,
                course_name: courseName,
                sender_name: "Your Name",
                image_link: imageUrl,
                id: id,
            });

            document.body.innerHTML = `<h1>Email xác nhận đã được gửi!</h1>`;
        } catch (error) {
            document.body.innerHTML = `<h2>Error sending email</h2><p>${error.message}</p>`;
            console.error("Error sending email:", error);
        }
    }

    const urlParams = new URLSearchParams(window.location.search);
    const recipientEmail = urlParams.get("email");
    const courseName = urlParams.get("course");
    const studentName = urlParams.get("name");
    const centerName = urlParams.get("center");
    const id = urlParams.get("id");

    if (!recipientEmail || !courseName || !studentName || !centerName || !id) {
        document.body.innerHTML = `<h2>Thiếu dữ liệu</h2>`;
    } else {
        sendEmail(recipientEmail, studentName, courseName, centerName, id);
    }
</script>
